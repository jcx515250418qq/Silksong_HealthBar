# å¬å”¤ç±»æ•Œäººç›¸å…³ä»£ç æ ‡è®°æ€»ç»“

æœ¬æ–‡æ¡£æ ‡è®°äº†æ¸¸æˆæºç ä¸­ä¸"å¬å”¤ç±»"æ•Œäººç›¸å…³çš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œä¾›ç ”ç©¶ä½¿ç”¨ã€‚

## 1. EnemySpawner.cs - æ•Œäººå¬å”¤å™¨æ ¸å¿ƒé€»è¾‘

**æ–‡ä»¶ä½ç½®**: `æ¸¸æˆæºç å‚è€ƒ/EnemySpawner.cs`

### ğŸ”¥ æ ¸å¿ƒå¬å”¤é€»è¾‘ä»£ç æ®µ:

#### 1.1 å¬å”¤å™¨åˆå§‹åŒ– (ç¬¬32-39è¡Œ)
```csharp
private void Awake()
{
    sprite = GetComponent<tk2dSprite>();
    sprite.color = startColor;
    if ((bool)enemyPrefab)
    {
        spawnedEnemy = UnityEngine.Object.Instantiate(enemyPrefab);  // ğŸ”¥ å®ä¾‹åŒ–å¬å”¤æ•Œäºº
        spawnedEnemy.SetActive(value: false);  // ğŸ”¥ åˆå§‹çŠ¶æ€ä¸ºç¦ç”¨
    }
}
```

#### 1.2 å¬å”¤æ¦‚ç‡åˆ¤æ–­å’ŒåŠ¨ç”»å¯åŠ¨ (ç¬¬41-60è¡Œ)
```csharp
private void Start()
{
    if (UnityEngine.Random.Range(0f, 1f) <= spawnChance)  // ğŸ”¥ å¬å”¤æ¦‚ç‡åˆ¤æ–­
    {
        // äº‹ä»¶ç›‘å¬å’ŒåŠ¨ç”»è®¾ç½®
        if ((bool)killEvent)
        {
            killEvent.ReceivedEvent += delegate
            {
                base.gameObject.SetActive(value: false);
            };
        }
        // iTweenåŠ¨ç”»é…ç½®
        Hashtable hashtable = new Hashtable();
        hashtable.Add("amount", moveBy);
        hashtable.Add("time", easeTime);
        hashtable.Add("easetype", easeType);
        hashtable.Add("space", Space.World);
        iTween.MoveBy(base.gameObject, hashtable);
    }
}
```

#### 1.3 å¬å”¤æ•Œäººæ¿€æ´»é€»è¾‘ (ç¬¬70-96è¡Œ)
```csharp
private void Update()
{
    // é¢œè‰²è¿‡æ¸¡å’Œæ—¶é—´åˆ¤æ–­
    elapsed += Time.deltaTime;
    sprite.color = Color.Lerp(startColor, endColor, Mathf.Clamp(elapsed / easeTime, 0f, 1f));
    
    if (elapsed > easeTime)
    {
        isComplete = true;
        spawnedEnemy.transform.position = base.transform.position;  // ğŸ”¥ è®¾ç½®å¬å”¤æ•Œäººä½ç½®
        spawnedEnemy.transform.localScale = base.transform.localScale;  // ğŸ”¥ è®¾ç½®å¬å”¤æ•Œäººç¼©æ”¾
        spawnedEnemy.SetActive(value: true);  // ğŸ”¥ æ¿€æ´»å¬å”¤çš„æ•Œäºº
        
        if (this.OnEnemySpawned != null)
        {
            this.OnEnemySpawned(spawnedEnemy);  // ğŸ”¥ è§¦å‘æ•Œäººå¬å”¤äº‹ä»¶
        }
        
        // è®¾ç½®æ•ŒäººAIçŠ¶æ€
        PlayMakerFSM playMakerFSM = PlayMakerFSM.FindFsmOnGameObject(spawnedEnemy, "chaser");
        if ((bool)playMakerFSM)
        {
            playMakerFSM.FsmVariables.FindFsmBool("Start Alert").Value = true;
        }
        
        base.gameObject.SetActive(value: false);  // ğŸ”¥ å¬å”¤å™¨è‡ªèº«ç¦ç”¨
    }
}
```

### ğŸ”¥ å…³é”®å­—æ®µ:
- `GameObject enemyPrefab` - è¦å¬å”¤çš„æ•Œäººé¢„åˆ¶ä½“
- `GameObject spawnedEnemy` - å·²å¬å”¤çš„æ•Œäººå®ä¾‹
- `float spawnChance` - å¬å”¤æ¦‚ç‡ (0-1)
- `event Action<GameObject> OnEnemySpawned` - æ•Œäººå¬å”¤å®Œæˆäº‹ä»¶

---

## 2. TrackSpawnedEnemiesAdd.cs - å¬å”¤æ•Œäººè·Ÿè¸ªç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: `æ¸¸æˆæºç å‚è€ƒ/TrackSpawnedEnemiesAdd.cs`

### ğŸ”¥ æ ¸å¿ƒè·Ÿè¸ªé€»è¾‘ä»£ç æ®µ:

#### 2.1 å¬å”¤æ•Œäººè·Ÿè¸ªå…¥å£ (ç¬¬18-38è¡Œ)
```csharp
public override void OnEnter()
{
    GameObject safe = Target.GetSafe(this);
    if ((bool)safe && (bool)SpawnedEnemy.Value)
    {
        TrackSpawnedEnemies track = safe.GetComponent<TrackSpawnedEnemies>() ?? safe.AddComponent<TrackSpawnedEnemies>();
        
        if (UsesEnemySpawner.Value)  // ğŸ”¥ ä½¿ç”¨EnemySpawnerçš„æƒ…å†µ
        {
            EnemySpawner component = SpawnedEnemy.Value.GetComponent<EnemySpawner>();
            if ((bool)component)
            {
                component.OnEnemySpawned += delegate(GameObject enemy)  // ğŸ”¥ è®¢é˜…å¬å”¤äº‹ä»¶
                {
                    AddTracked(track, enemy);  // ğŸ”¥ æ·»åŠ åˆ°è·Ÿè¸ªåˆ—è¡¨
                };
            }
        }
        else
        {
            AddTracked(track, SpawnedEnemy.Value);  // ğŸ”¥ ç›´æ¥æ·»åŠ åˆ°è·Ÿè¸ª
        }
    }
    Finish();
}
```

#### 2.2 æ·»åŠ è·Ÿè¸ªç›®æ ‡ (ç¬¬40-47è¡Œ)
```csharp
private void AddTracked(TrackSpawnedEnemies tracker, GameObject obj)
{
    HealthManager component = obj.GetComponent<HealthManager>();  // ğŸ”¥ è·å–è¡€é‡ç®¡ç†å™¨
    if ((bool)component)
    {
        tracker.Add(component);  // ğŸ”¥ æ·»åŠ åˆ°è·Ÿè¸ªå™¨
    }
}
```

### ğŸ”¥ å…³é”®å­—æ®µ:
- `FsmGameObject SpawnedEnemy` - è¢«å¬å”¤çš„æ•Œäººå¯¹è±¡
- `FsmBool UsesEnemySpawner` - æ˜¯å¦ä½¿ç”¨EnemySpawner

---

## 3. HealthManager.cs - å¬å”¤æ•Œäººæ­»äº¡å¤„ç†

**æ–‡ä»¶ä½ç½®**: `æ¸¸æˆæºç å‚è€ƒ/HealthManager.cs`

### ğŸ”¥ æ ¸å¿ƒæ­»äº¡å¤„ç†ä»£ç æ®µ:

#### 3.1 æ­»äº¡æ–¹æ³•å…¥å£ (ç¬¬1536è¡Œ)
```csharp
public void Die(float? attackDirection, AttackTypes attackType, NailElements nailElement, GameObject damageSource, bool ignoreEvasion = false, float corpseFlingMultiplier = 1f, bool overrideSpecialDeath = false, bool disallowDropFling = false)
{
    if (isDead || (preventDeathAfterHero && HeroController.instance.cState.dead))
    {
        return;  // ğŸ”¥ é˜²æ­¢é‡å¤æ­»äº¡
    }
    // ... æ­»äº¡å¤„ç†é€»è¾‘
}
```

#### 3.2 æ­»äº¡äº‹ä»¶è§¦å‘ (ç¬¬1663è¡Œ)
```csharp
SendDeathEvent();  // ğŸ”¥ å‘é€æ­»äº¡äº‹ä»¶
```

#### 3.3 æ­»äº¡äº‹ä»¶å®ç° (ç¬¬1862-1868è¡Œ)
```csharp
public void SendDeathEvent()
{
    if (this.OnDeath != null)
    {
        this.OnDeath();  // ğŸ”¥ è§¦å‘OnDeathäº‹ä»¶ - è¡€æ¡åº”è¯¥ç›‘å¬æ­¤äº‹ä»¶
    }
}
```

### ğŸ”¥ å…³é”®äº‹ä»¶:
- `event Action OnDeath` - æ­»äº¡äº‹ä»¶ï¼Œè¡€æ¡ç»„ä»¶åº”ç›‘å¬æ­¤äº‹ä»¶è¿›è¡Œæ¸…ç†

---

## 4. PlayerData.cs - å¬å”¤ç›¸å…³æ¸¸æˆæ•°æ®

**æ–‡ä»¶ä½ç½®**: `æ¸¸æˆæºç å‚è€ƒ/PlayerData.cs`

### ğŸ”¥ å¬å”¤ç›¸å…³å­—æ®µ:

#### 4.1 ä¹Œé¸¦å¬å”¤ç›¸å…³ (ç¬¬1343-1345è¡Œ)
```csharp
public string CrowSummonsAppearedScene;  // ğŸ”¥ ä¹Œé¸¦å¬å”¤å‡ºç°çš„åœºæ™¯
public bool OpenedCrowSummonsDoor;       // ğŸ”¥ æ˜¯å¦æ‰“å¼€äº†ä¹Œé¸¦å¬å”¤é—¨
```

#### 4.2 æ•‘ä¸–ä¸»å¬å”¤ (ç¬¬1903è¡Œ)
```csharp
public bool EncounteredSummonedSaviour;  // ğŸ”¥ æ˜¯å¦é‡åˆ°äº†è¢«å¬å”¤çš„æ•‘ä¸–ä¸»
```

#### 4.3 æ¹–æ³Šæ³•çƒå¬å”¤ (ç¬¬2392è¡Œ)
```csharp
public bool summonedLakeOrbs;            // ğŸ”¥ æ˜¯å¦å¬å”¤äº†æ¹–æ³Šæ³•çƒ
```

---

## ğŸš¨ å…³é”®é—®é¢˜åˆ†æ

### è¡€æ¡åœç•™é—®é¢˜çš„æ ¹æœ¬åŸå› :

1. **EnemySpawnerç¼ºå°‘OnDestroyæ¸…ç†**: EnemySpawnerè¢«é”€æ¯æ—¶æ²¡æœ‰æ¸…ç†å¬å”¤çš„æ•Œäºº
2. **EnemyHealthBaræœªç›‘å¬æ­»äº¡äº‹ä»¶**: è¡€æ¡ç»„ä»¶æ²¡æœ‰è®¢é˜…HealthManagerçš„OnDeathäº‹ä»¶
3. **å¬å”¤æ•Œäººç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸å®Œæ•´**: ç¼ºå°‘å¬å”¤æ•Œäººæ­»äº¡æ—¶çš„è¡€æ¡æ¸…ç†é€»è¾‘

### å»ºè®®çš„ä¿®å¤æ–¹æ¡ˆ:

1. åœ¨EnemyHealthBarçš„Startæ–¹æ³•ä¸­è®¢é˜…OnDeathäº‹ä»¶
2. åœ¨OnDeathäº‹ä»¶å¤„ç†ä¸­ç«‹å³é”€æ¯è¡€æ¡UI
3. åœ¨OnDestroyæ–¹æ³•ä¸­å–æ¶ˆäº‹ä»¶è®¢é˜…

---

## ğŸ“ ç ”ç©¶è¦ç‚¹

- **å¬å”¤æµç¨‹**: EnemySpawner â†’ å®ä¾‹åŒ– â†’ æ¿€æ´» â†’ è§¦å‘OnEnemySpawnedäº‹ä»¶
- **è·Ÿè¸ªæœºåˆ¶**: TrackSpawnedEnemiesAddç›‘å¬OnEnemySpawnedå¹¶æ·»åŠ åˆ°è·Ÿè¸ªå™¨
- **æ­»äº¡å¤„ç†**: HealthManager.Die() â†’ SendDeathEvent() â†’ OnDeathäº‹ä»¶
- **è¡€æ¡é—®é¢˜**: è¡€æ¡ç»„ä»¶æœªæ­£ç¡®ç›‘å¬OnDeathäº‹ä»¶å¯¼è‡´æ¸…ç†å¤±è´¥

è¿™äº›ä»£ç æ®µæ„æˆäº†å®Œæ•´çš„å¬å”¤ç±»æ•Œäººç³»ç»Ÿï¼Œç ”ç©¶æ—¶é‡ç‚¹å…³æ³¨äº‹ä»¶æµå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚